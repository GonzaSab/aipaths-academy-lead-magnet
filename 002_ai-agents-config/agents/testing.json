{
  "$schema": "https://ai-agents.dev/schema/agent.json",
  "name": "testing",
  "version": "1.0.0",
  "description": "Automatically generates unit and integration tests for code",

  "model": {
    "provider": "openai",
    "name": "gpt-4-turbo-preview",
    "fallback": "gpt-3.5-turbo",
    "temperature": 0.4,
    "maxTokens": 4096
  },

  "systemPrompt": "You are a testing expert who writes comprehensive, maintainable test suites. Your tests should:\n\n1. Cover all code paths including edge cases\n2. Test error conditions and boundary cases\n3. Be clear, readable, and well-organized\n4. Follow testing best practices (AAA pattern, clear assertions)\n5. Use appropriate mocking and stubbing\n6. Include descriptive test names\n\nGenerate tests that would catch real bugs and provide confidence in code quality.",

  "triggers": [
    {
      "event": "push",
      "enabled": true,
      "filter": {
        "paths": ["src/**/*.ts", "src/**/*.js", "lib/**"],
        "exclude": ["**/*.test.*", "**/*.spec.*"]
      }
    },
    {
      "event": "pull_request.opened",
      "enabled": true
    },
    {
      "event": "manual",
      "enabled": true
    }
  ],

  "testTypes": [
    {
      "type": "unit",
      "enabled": true,
      "framework": "jest",
      "coverage": {
        "target": 80,
        "enforceOnNew": true
      }
    },
    {
      "type": "integration",
      "enabled": true,
      "framework": "jest",
      "coverage": {
        "target": 70,
        "enforceOnNew": false
      }
    },
    {
      "type": "e2e",
      "enabled": false,
      "framework": "playwright"
    }
  ],

  "tools": [
    {
      "name": "filesystem",
      "enabled": true,
      "permissions": ["read", "write"]
    },
    {
      "name": "ast-parser",
      "enabled": true,
      "languages": ["javascript", "typescript", "python"]
    },
    {
      "name": "test-runner",
      "enabled": true,
      "frameworks": ["jest", "vitest", "pytest"]
    },
    {
      "name": "coverage-analyzer",
      "enabled": true
    }
  ],

  "workflow": {
    "steps": [
      {
        "name": "detect-new-code",
        "action": "git.getChangedFiles",
        "filter": {
          "extensions": [".js", ".ts", ".tsx", ".py"],
          "exclude": ["**/*.test.*", "**/*.spec.*"]
        },
        "output": "newCodeFiles"
      },
      {
        "name": "check-existing-tests",
        "action": "filesystem.findTests",
        "input": "newCodeFiles",
        "output": "existingTests"
      },
      {
        "name": "analyze-coverage",
        "action": "coverage.analyze",
        "input": ["newCodeFiles", "existingTests"],
        "output": "coverageGaps"
      },
      {
        "name": "parse-code",
        "action": "ast.parse",
        "input": "newCodeFiles",
        "output": "codeStructure"
      },
      {
        "name": "identify-test-cases",
        "action": "ast.extractTestableUnits",
        "input": "codeStructure",
        "output": "testableFunctions"
      },
      {
        "name": "generate-tests",
        "action": "llm.generateTests",
        "input": ["testableFunctions", "coverageGaps"],
        "prompt": "Generate comprehensive tests for the following code:\n\n1. Test all code paths (happy path, error cases, edge cases)\n2. Use the {framework} testing framework\n3. Follow AAA pattern (Arrange, Act, Assert)\n4. Include clear, descriptive test names\n5. Mock external dependencies\n6. Test boundary conditions\n\nGenerate tests that would catch real bugs.",
        "output": "generatedTests"
      },
      {
        "name": "format-tests",
        "action": "format.prettify",
        "input": "generatedTests",
        "output": "formattedTests"
      },
      {
        "name": "write-test-files",
        "action": "filesystem.writeTests",
        "input": "formattedTests",
        "config": {
          "namingPattern": "{filename}.test.{ext}"
        },
        "output": "testFiles"
      },
      {
        "name": "run-tests",
        "action": "test.run",
        "input": "testFiles",
        "output": "testResults"
      },
      {
        "name": "validate-tests",
        "action": "validate.testResults",
        "input": "testResults",
        "condition": "allTestsPass",
        "output": "validation"
      },
      {
        "name": "commit-tests",
        "action": "git.commit",
        "condition": "validation.passed",
        "input": "testFiles",
        "config": {
          "message": "test: Add automated tests for {changedFiles}"
        }
      },
      {
        "name": "notify",
        "action": "slack.notify",
        "input": ["testResults", "validation"],
        "template": "Generated {testCount} tests with {coverage}% coverage"
      }
    ]
  },

  "testPatterns": {
    "unit": {
      "template": "describe('{functionName}', () => {\n  it('{testDescription}', () => {\n    // Arrange\n    {setup}\n    \n    // Act\n    {action}\n    \n    // Assert\n    {assertions}\n  });\n});",
      "cases": [
        "happy-path",
        "error-handling",
        "edge-cases",
        "boundary-conditions",
        "null-undefined",
        "empty-inputs"
      ]
    },
    "integration": {
      "template": "describe('{moduleName} Integration', () => {\n  beforeAll(() => {\n    {setup}\n  });\n  \n  it('{testDescription}', async () => {\n    {test}\n  });\n  \n  afterAll(() => {\n    {cleanup}\n  });\n});",
      "cases": [
        "module-interaction",
        "data-flow",
        "error-propagation"
      ]
    }
  },

  "rules": [
    {
      "id": "coverage-threshold",
      "name": "Minimum Coverage",
      "config": {
        "minLineCoverage": 80,
        "minBranchCoverage": 75,
        "minFunctionCoverage": 85
      },
      "blocking": true
    },
    {
      "id": "test-quality",
      "name": "Test Quality Checks",
      "config": {
        "noSkippedTests": true,
        "noOnlyTests": true,
        "hasAssertions": true,
        "clearTestNames": true
      },
      "blocking": false
    }
  ],

  "notifications": {
    "slack": {
      "enabled": true,
      "channel": "#testing",
      "events": ["tests-generated", "coverage-improved", "tests-failed"]
    },
    "github": {
      "enabled": true,
      "events": ["coverage-report"],
      "format": "comment"
    }
  },

  "performance": {
    "maxFilesPerBatch": 5,
    "timeout": 180000,
    "parallelGeneration": true
  },

  "output": {
    "format": "test-file",
    "includeComments": true,
    "includeImports": true,
    "generateMocks": true
  }
}
