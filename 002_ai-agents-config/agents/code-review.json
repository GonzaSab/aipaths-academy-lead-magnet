{
  "$schema": "https://ai-agents.dev/schema/agent.json",
  "name": "code-review",
  "version": "1.0.0",
  "description": "Automatically reviews pull requests for code quality, security, and best practices",

  "model": {
    "provider": "openai",
    "name": "gpt-4-turbo-preview",
    "fallback": "gpt-3.5-turbo",
    "temperature": 0.3,
    "maxTokens": 4096
  },

  "systemPrompt": "You are an expert code reviewer with 10+ years of software engineering experience. Your role is to review code changes thoroughly and provide constructive feedback. Focus on:\n\n1. Code Quality: Readability, maintainability, and adherence to best practices\n2. Bugs: Potential issues, edge cases, and logical errors\n3. Security: Vulnerabilities and unsafe practices\n4. Performance: Inefficient algorithms or resource usage\n5. Testing: Missing test cases or inadequate coverage\n\nProvide specific, actionable feedback with code examples when possible. Be constructive and educational in your comments.",

  "triggers": [
    {
      "event": "pull_request.opened",
      "enabled": true
    },
    {
      "event": "pull_request.synchronize",
      "enabled": true
    },
    {
      "event": "pull_request.reopened",
      "enabled": true
    }
  ],

  "rules": [
    {
      "id": "check-complexity",
      "name": "Check Code Complexity",
      "enabled": true,
      "config": {
        "maxCyclomaticComplexity": 10,
        "maxFunctionLength": 50,
        "maxFileLength": 500
      },
      "severity": "warning"
    },
    {
      "id": "check-security",
      "name": "Security Vulnerabilities",
      "enabled": true,
      "config": {
        "checkInjection": true,
        "checkXSS": true,
        "checkAuthz": true,
        "checkHardcodedSecrets": true
      },
      "severity": "error"
    },
    {
      "id": "check-style",
      "name": "Code Style",
      "enabled": true,
      "config": {
        "enforceTypes": true,
        "requireComments": true,
        "namingConventions": true
      },
      "severity": "info"
    },
    {
      "id": "check-performance",
      "name": "Performance Issues",
      "enabled": true,
      "config": {
        "checkAlgorithmComplexity": true,
        "checkMemoryLeaks": true,
        "checkIneffientLoops": true
      },
      "severity": "warning"
    },
    {
      "id": "check-testing",
      "name": "Test Coverage",
      "enabled": true,
      "config": {
        "requireTests": true,
        "minCoverage": 80,
        "checkEdgeCases": true
      },
      "severity": "warning"
    }
  ],

  "tools": [
    {
      "name": "github",
      "enabled": true,
      "permissions": ["read-pr", "write-comments", "read-files"]
    },
    {
      "name": "filesystem",
      "enabled": true,
      "permissions": ["read"]
    },
    {
      "name": "static-analysis",
      "enabled": true,
      "config": {
        "engines": ["eslint", "typescript", "sonarqube"]
      }
    }
  ],

  "workflow": {
    "steps": [
      {
        "name": "fetch-pr-changes",
        "action": "github.getPRFiles",
        "output": "changedFiles"
      },
      {
        "name": "filter-code-files",
        "action": "filter",
        "input": "changedFiles",
        "config": {
          "extensions": [".js", ".ts", ".tsx", ".jsx", ".py", ".go", ".java"]
        },
        "output": "codeFiles"
      },
      {
        "name": "run-static-analysis",
        "action": "staticAnalysis.analyze",
        "input": "codeFiles",
        "output": "staticAnalysisResults"
      },
      {
        "name": "analyze-with-llm",
        "action": "llm.analyze",
        "input": "codeFiles",
        "context": "staticAnalysisResults",
        "prompt": "Review the following code changes. For each file, identify:\n1. Potential bugs or issues\n2. Security vulnerabilities\n3. Performance concerns\n4. Code style problems\n5. Missing tests or edge cases\n\nProvide specific line numbers and suggested improvements.",
        "output": "llmFeedback"
      },
      {
        "name": "format-feedback",
        "action": "format.comments",
        "input": "llmFeedback",
        "config": {
          "style": "github-review",
          "groupBySeverity": true,
          "includeSuggestions": true
        },
        "output": "formattedComments"
      },
      {
        "name": "post-comments",
        "action": "github.postReview",
        "input": "formattedComments",
        "config": {
          "event": "COMMENT",
          "autoApprove": false
        }
      },
      {
        "name": "notify",
        "action": "slack.notify",
        "condition": "hasCriticalIssues",
        "input": "formattedComments"
      }
    ]
  },

  "notifications": {
    "slack": {
      "enabled": true,
      "channel": "#code-review",
      "events": ["review-complete", "critical-issues-found"],
      "template": "Code review complete for PR #{pr_number}: {summary}"
    },
    "github": {
      "enabled": true,
      "events": ["review-complete"]
    },
    "email": {
      "enabled": false,
      "recipients": [],
      "events": ["critical-issues-found"]
    }
  },

  "performance": {
    "maxConcurrentPRs": 3,
    "timeout": 180000,
    "retries": 2,
    "caching": {
      "enabled": true,
      "ttl": 3600
    }
  },

  "costOptimization": {
    "useGPT35ForSimpleChecks": true,
    "maxTokensPerFile": 2000,
    "batchSimilarFiles": true,
    "enableResultCaching": true
  },

  "output": {
    "format": "github-review-comment",
    "language": "markdown",
    "includeSeverity": true,
    "includeLineNumbers": true,
    "provideFixes": true,
    "educationalTone": true
  }
}
