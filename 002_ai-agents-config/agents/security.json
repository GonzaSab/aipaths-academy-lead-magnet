{
  "$schema": "https://ai-agents.dev/schema/agent.json",
  "name": "security",
  "version": "1.0.0",
  "description": "Scans for security vulnerabilities and enforces security best practices",

  "model": {
    "provider": "anthropic",
    "name": "claude-3-5-sonnet-20241022",
    "fallback": "gpt-4-turbo-preview",
    "temperature": 0.2,
    "maxTokens": 8096
  },

  "systemPrompt": "You are a security expert specializing in application security. Your role is to:\n\n1. Identify security vulnerabilities (OWASP Top 10)\n2. Check for insecure coding patterns\n3. Validate authentication and authorization\n4. Review data handling and privacy\n5. Audit dependency security\n\nBe thorough and conservative in security assessments. Provide specific, actionable recommendations with severity ratings.",

  "triggers": [
    {
      "event": "pull_request.opened",
      "enabled": true
    },
    {
      "event": "push",
      "enabled": true,
      "filter": {
        "branches": ["main", "develop"]
      }
    },
    {
      "event": "schedule",
      "enabled": true,
      "cron": "0 2 * * *"
    }
  ],

  "securityChecks": [
    {
      "category": "injection",
      "checks": [
        "sql-injection",
        "nosql-injection",
        "command-injection",
        "xss"
      ],
      "severity": "critical"
    },
    {
      "category": "authentication",
      "checks": [
        "weak-passwords",
        "insecure-session-handling",
        "missing-mfa",
        "hardcoded-credentials"
      ],
      "severity": "high"
    },
    {
      "category": "authorization",
      "checks": [
        "broken-access-control",
        "privilege-escalation",
        "insecure-direct-object-reference"
      ],
      "severity": "high"
    },
    {
      "category": "data-exposure",
      "checks": [
        "sensitive-data-logging",
        "missing-encryption",
        "insecure-transmission",
        "pii-exposure"
      ],
      "severity": "high"
    },
    {
      "category": "dependencies",
      "checks": [
        "vulnerable-dependencies",
        "outdated-packages",
        "malicious-packages"
      ],
      "severity": "medium"
    }
  ],

  "tools": [
    {
      "name": "filesystem",
      "enabled": true,
      "permissions": ["read"]
    },
    {
      "name": "ast-parser",
      "enabled": true
    },
    {
      "name": "dependency-checker",
      "enabled": true,
      "sources": ["npm-audit", "snyk", "owasp-dependency-check"]
    },
    {
      "name": "secret-scanner",
      "enabled": true
    }
  ],

  "workflow": {
    "steps": [
      {
        "name": "scan-code-changes",
        "action": "git.getChangedFiles",
        "output": "changedFiles"
      },
      {
        "name": "scan-secrets",
        "action": "secrets.scan",
        "input": "changedFiles",
        "patterns": [
          "api_key",
          "password",
          "private_key",
          "token",
          "secret"
        ],
        "output": "foundSecrets"
      },
      {
        "name": "parse-code",
        "action": "ast.parse",
        "input": "changedFiles",
        "output": "codeStructure"
      },
      {
        "name": "check-injection",
        "action": "security.checkInjection",
        "input": "codeStructure",
        "output": "injectionVulns"
      },
      {
        "name": "check-authentication",
        "action": "security.checkAuth",
        "input": "codeStructure",
        "output": "authIssues"
      },
      {
        "name": "check-authorization",
        "action": "security.checkAuthz",
        "input": "codeStructure",
        "output": "authzIssues"
      },
      {
        "name": "scan-dependencies",
        "action": "dependencies.audit",
        "output": "depVulnerabilities"
      },
      {
        "name": "analyze-with-llm",
        "action": "llm.securityAnalysis",
        "input": [
          "foundSecrets",
          "injectionVulns",
          "authIssues",
          "authzIssues",
          "depVulnerabilities"
        ],
        "prompt": "Perform a comprehensive security analysis:\n\n{findings}\n\nFor each issue:\n1. Describe the vulnerability\n2. Rate severity (Critical/High/Medium/Low)\n3. Explain the risk\n4. Provide specific fix\n5. Suggest prevention measures",
        "output": "securityReport"
      },
      {
        "name": "prioritize-findings",
        "action": "prioritize.bySeverity",
        "input": "securityReport",
        "output": "prioritizedFindings"
      },
      {
        "name": "block-if-critical",
        "action": "validate.security",
        "input": "prioritizedFindings",
        "condition": "hasCriticalIssues",
        "blocking": true
      },
      {
        "name": "create-security-report",
        "action": "report.generate",
        "input": "prioritizedFindings",
        "output": "formattedReport"
      },
      {
        "name": "post-pr-comment",
        "action": "github.postComment",
        "condition": "isPullRequest",
        "input": "formattedReport"
      },
      {
        "name": "create-security-issue",
        "action": "github.createIssue",
        "condition": "hasCriticalOrHighIssues",
        "input": "formattedReport",
        "config": {
          "labels": ["security", "urgent"],
          "private": true
        }
      },
      {
        "name": "notify-security-team",
        "action": "slack.notify",
        "condition": "hasCriticalIssues",
        "channel": "#security-alerts",
        "input": "prioritizedFindings"
      }
    ]
  },

  "vulnerabilityPatterns": {
    "sql-injection": [
      "executeQuery\\([^?]*\\+",
      "query\\([^?]*\\+.*\\)",
      "raw\\(.*\\+.*\\)"
    ],
    "xss": [
      "innerHTML\\s*=",
      "dangerouslySetInnerHTML",
      "document\\.write\\("
    ],
    "hardcoded-secrets": [
      "api_key\\s*=\\s*['\"][^'\"]+['\"]",
      "password\\s*=\\s*['\"][^'\"]+['\"]",
      "private_key\\s*=\\s*['\"]"
    ]
  },

  "rules": {
    "blocking": {
      "criticalVulnerabilities": true,
      "exposedSecrets": true,
      "highSeverityAuth": true
    },
    "reporting": {
      "alwaysReport": ["critical", "high"],
      "groupBy": "severity",
      "includeRemediation": true
    }
  },

  "notifications": {
    "slack": {
      "enabled": true,
      "channels": {
        "critical": "#security-alerts",
        "high": "#security",
        "medium": "#code-quality",
        "low": "#dev"
      }
    },
    "email": {
      "enabled": true,
      "recipients": ["security@company.com"],
      "events": ["critical-vulnerability"]
    },
    "github": {
      "enabled": true,
      "events": ["security-issue-created"]
    }
  },

  "performance": {
    "timeout": 300000,
    "parallelScans": true,
    "caching": {
      "enabled": true,
      "ttl": 3600
    }
  },

  "output": {
    "format": "security-report",
    "sections": [
      "executive-summary",
      "critical-findings",
      "high-severity",
      "medium-severity",
      "recommendations",
      "remediation-guide"
    ],
    "includeEvidence": true,
    "includeCVEs": true,
    "includeRemediation": true
  }
}
